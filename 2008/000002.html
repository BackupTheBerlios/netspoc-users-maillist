<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netspoc-users] All/any with netspoc? How to grant access to	publicweb server
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netspoc-users/2008/index.html" >
   <LINK REL="made" HREF="mailto:netspoc-users%40lists.berlios.de?Subject=Re%3A%20%5BNetspoc-users%5D%20All/any%20with%20netspoc%3F%20How%20to%20grant%20access%20to%0A%09publicweb%20server&In-Reply-To=%3C20080922090301.183090%40gmx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000001.html">
   <LINK REL="Next"  HREF="000003.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netspoc-users] All/any with netspoc? How to grant access to	publicweb server</H1>
    <B>Heinz Knutzen</B> 
    <A HREF="mailto:netspoc-users%40lists.berlios.de?Subject=Re%3A%20%5BNetspoc-users%5D%20All/any%20with%20netspoc%3F%20How%20to%20grant%20access%20to%0A%09publicweb%20server&In-Reply-To=%3C20080922090301.183090%40gmx.net%3E"
       TITLE="[Netspoc-users] All/any with netspoc? How to grant access to	publicweb server">heinz.knutzen at gmx.de
       </A><BR>
    <I>Mon Sep 22 11:03:01 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000001.html">[Netspoc-users] All/any with netspoc? How to grant access to public	web server
</A></li>
        <LI>Next message: <A HREF="000003.html">[Netspoc-users] All/any with netspoc? How to grant access to	public web server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2">[ date ]</a>
              <a href="thread.html#2">[ thread ]</a>
              <a href="subject.html#2">[ subject ]</a>
              <a href="author.html#2">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Martin,

there are two problems with your netspoc configuration.

1. 
A network with attribute 'route_hint' must not be referenced in a rule.
Unfortunately version 2.281 of netspoc silently ignores such rules.
Therefore your policy:pubwww does nothing.
You should use attribute 'subnet_of' instead.
(Attribute 'route_hint' should only be used to get optimized static routing entries.)

2.
The hardware interfaces of router:myrouter should use different names, e.g. 'e0' and 'e1'.
Otherwise the generated configuration will be mixed for both interfaces.

With this changes you will get a reasonable result:

-------------------- Input ------------------------

network:public = {
    ip = 2.2.2.0/24;
    subnet_of = network:internet;
    host:www = { ip = 2.2.2.10; }
}

network:internet = {
    ip = 0.0.0.0/0;
#    route_hint;
}

network:isp-me = {
    ip = 2.2.3.0/30;
    subnet_of = network:internet;
}

router:isp0 = {
    interface:isp-me = {
        ip = 2.2.3.1;
    }
    interface:internet = {
    }
}

router:myrouter = {
    managed = full;
    model = IOS;
    interface:public = {
        ip = 2.2.2.1;
        hardware = i0;
    }
    interface:isp-me= {
        ip = 2.2.3.2;
        hardware = i1;
    }
}

service:http = tcp 80;

policy:pubwww = {
    description = how to allow all?
    user = network:internet;
    permit src = user;
        dst = host:www;
        srv = service:http;
}

-------------------- Output ------------------------
# ./netspoc -noauto_default_route andrew  code
Network Security Policy Compiler, version 2.281
Read 2 routers, 3 networks, 1 hosts
Read 1 services, 0 service groups
Read 0 groups, 1 policies
Arranging services
Linking topology
Distributing NAT
Finding subnets
Preparing security domains and areas
Preparing fast path traversal
Converting hosts to subnets
Expanding policies
Preparing crypto tunnels and expanding crypto rules
Optimizing globally
Checking rules with 'any' objects
Finding routes and statics
Checking for duplicate routes
Generating reverse rules for stateless routers
Marking rules for secondary optimization
Optimizing globally
Distributing rules
Optimizing locally
Printing code

# cat code/myrouter 
! Generated by Network Security Policy Compiler, version 2.281

! [ BEGIN router:myrouter ]
! [ Model = IOS ]
! [ Routing ]
ip route 0.0.0.0 0.0.0.0 2.2.3.1
! [ ACL ]
ip access-list extended i0_in
 deny ip any  host 2.2.2.1 
 deny ip any  host 2.2.3.2 
 permit tcp host 2.2.2.10  any  established
 deny ip any  any 
interface i0
 ip access-group i0_in in

ip access-list extended i1_in
 deny ip any  host 2.2.2.1 
 deny ip any  host 2.2.3.2 
 permit tcp any  host 2.2.2.10 eq 80
 deny ip any  any 
interface i1
 ip access-group i1_in in

! [ END router:myrouter ]


-- 
GMX Kostenlose Spiele: Einfach online spielen und Spa&#223; haben mit Pastry Passion!
<A HREF="http://games.entertainment.gmx.net/de/entertainment/games/free/puzzle/6169196">http://games.entertainment.gmx.net/de/entertainment/games/free/puzzle/6169196</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000001.html">[Netspoc-users] All/any with netspoc? How to grant access to public	web server
</A></li>
	<LI>Next message: <A HREF="000003.html">[Netspoc-users] All/any with netspoc? How to grant access to	public web server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2">[ date ]</a>
              <a href="thread.html#2">[ thread ]</a>
              <a href="subject.html#2">[ subject ]</a>
              <a href="author.html#2">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netspoc-users">More information about the Netspoc-users
mailing list</a><br>
</body></html>
